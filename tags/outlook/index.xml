<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Outlook on kars7e&#39;s Blog</title>
    <link>http://blog.kars7e.io/tags/outlook/index.xml</link>
    <description>Recent content in Outlook on kars7e&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="http://blog.kars7e.io/tags/outlook/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Creating vcards in rails using vpim</title>
      <link>http://blog.kars7e.io/2013/09/12/creating-vcards-in-rails-using-vpim-which-works/</link>
      <pubDate>Thu, 12 Sep 2013 12:28:00 +0000</pubDate>
      
      <guid>http://blog.kars7e.io/2013/09/12/creating-vcards-in-rails-using-vpim-which-works/</guid>
      <description>&lt;p&gt;Short info - how to create vcards in rails, which work correctly in Outlook 20xx.&lt;/p&gt;

&lt;p&gt;
I’m using awsome vpim gem.
In controller, where you will generate vcard, add this require:&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #007020&#34;&gt;require&lt;/span&gt; &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;vpim&lt;span style=&#34;color: #333333&#34;&gt;/&lt;/span&gt;vcard&lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The best working solution is to encode your vcard in utf-8, which is not currently available in vpim, so lets add following piece of code (after the require):&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color: #0e84b5; font-weight: bold&#34;&gt;Vpim&lt;/span&gt;
  &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #BB0066; font-weight: bold&#34;&gt;DirectoryInfo&lt;/span&gt;
    &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #BB0066; font-weight: bold&#34;&gt;Field&lt;/span&gt;
      &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #333333&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color: #007020&#34;&gt;self&lt;/span&gt;
        alias_method &lt;span style=&#34;color: #AA6600&#34;&gt;:orig_create&lt;/span&gt;, &lt;span style=&#34;color: #AA6600&#34;&gt;:create&lt;/span&gt;

        &lt;span style=&#34;color: #888888&#34;&gt;# we overwrite Field.create for setting the CHARSET&lt;/span&gt;
        &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0066BB; font-weight: bold&#34;&gt;create&lt;/span&gt;(&lt;span style=&#34;color: #007020&#34;&gt;name&lt;/span&gt;, value&lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, params&lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt;{})
          &lt;span style=&#34;color: #888888&#34;&gt;# specify the lines you don&amp;#39;t want to add a charset to&lt;/span&gt;
          lines_to_ignore &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #DD2200; background-color: #fff0f0&#34;&gt;%w(BEGIN END VERSION)&lt;/span&gt;
          params&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;merge!({&lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;CHARSET&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #333333&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;}) &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;unless&lt;/span&gt; lines_to_ignore&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;include? &lt;span style=&#34;color: #007020&#34;&gt;name&lt;/span&gt;
          orig_create(&lt;span style=&#34;color: #007020&#34;&gt;name&lt;/span&gt;, value, params)
        &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;
      &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;

    &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;
  &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;It&amp;rdquo;s important to set charset to utf-8, not UTF-8 - Outlook won’t handle it!
Now you have to generate vcard itself - i’m doing it with following piece of code:&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;  &lt;span style=&#34;color: #888888&#34;&gt;#controller method&lt;/span&gt;
  &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color: #0066BB; font-weight: bold&#34;&gt;vcard&lt;/span&gt;
    person &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #003366; font-weight: bold&#34;&gt;Person&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;visible&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;find(params&lt;span style=&#34;color: #333333&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #AA6600&#34;&gt;:id&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;]&lt;/span&gt;)
    card &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #003366; font-weight: bold&#34;&gt;Vpim&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color: #003366; font-weight: bold&#34;&gt;Vcard&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color: #003366; font-weight: bold&#34;&gt;Maker&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;make2 &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt;maker&lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt;

      &lt;span style=&#34;color: #888888&#34;&gt;#setting up name&lt;/span&gt;
      maker&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;add_name &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color: #007020&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt;
        &lt;span style=&#34;color: #007020&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;prefix &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;
        &lt;span style=&#34;color: #007020&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;given &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; person&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;first_name
        &lt;span style=&#34;color: #007020&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;family &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; person&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;last_name
      &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;

      &lt;span style=&#34;color: #888888&#34;&gt;# setting up address.&lt;/span&gt;
      maker&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;add_addr &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt;addr&lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt;
        addr&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;location &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;work&amp;#39;&lt;/span&gt;
        addr&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;street &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; person&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;location&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;street
        addr&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;postalcode &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; person&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;location&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;zip_code
        addr&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;region &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; person&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;location&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;city
        addr&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;country &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;Poland&amp;#39;&lt;/span&gt;
      &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;

      maker&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;title &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; person&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;law_level
      maker&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;org &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;your company&amp;#39;&lt;/span&gt;
      maker&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;add_field(&lt;span style=&#34;color: #003366; font-weight: bold&#34;&gt;Vpim&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color: #003366; font-weight: bold&#34;&gt;DirectoryInfo&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color: #003366; font-weight: bold&#34;&gt;Field&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;create(&lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;office&amp;#39;&lt;/span&gt;, person&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;location&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;name ))
      maker&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;add_tel(person&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;phone) { &lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt;e&lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt; e&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;location &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;cell&amp;#39;&lt;/span&gt;}
      maker&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;add_tel(person&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;location&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;phone) { &lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt;e&lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt; e&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;location &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;work&amp;#39;&lt;/span&gt;}


      maker&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;add_email(person&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;email) { &lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt;e&lt;span style=&#34;color: #333333&#34;&gt;|&lt;/span&gt; e&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;location &lt;span style=&#34;color: #333333&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;work&amp;#39;&lt;/span&gt; }

    &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;At the end, we have to send the file (still vcard method) :&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt; send_data card&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;to_s, &lt;span style=&#34;color: #AA6600&#34;&gt;:type&lt;/span&gt; &lt;span style=&#34;color: #333333&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;text&lt;span style=&#34;color: #333333&#34;&gt;/&lt;/span&gt;x&lt;span style=&#34;color: #333333&#34;&gt;-&lt;/span&gt;vcard&lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color: #AA6600&#34;&gt;:filename&lt;/span&gt; &lt;span style=&#34;color: #333333&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #003366; font-weight: bold&#34;&gt;URI&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;::&lt;/span&gt;encode(person&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;name) &lt;span style=&#34;color: #333333&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #333333&#34;&gt;.&lt;/span&gt;vcf&lt;span style=&#34;background-color: #fff0f0&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;
  &lt;span style=&#34;color: #008800; font-weight: bold&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;Things to remember:
* Make correct charset
* set content-type (:type option) - you can sent charset also in content-type.
* URI:encode helps when filename includes non-ASCII characters&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>